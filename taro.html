<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarô Divino Siriano - A Jornada de Sabbah</title>    
    <link rel="stylesheet" href="css/portal.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
    <style>
        /* Estilos de Estrutura e Visibilidade */
        .tela { display: none; width: 100%; min-height: 100vh; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .tela.ativa { display: flex !important; }
        
        /* Grid de Métodos com Imagens de Fundo */
        .grid-metodos { display: flex; gap: 30px; justify-content: center; margin-top: 40px; }
        .card-metodo { 
            width: 200px; height: 300px; 
            border: 2px solid #d4af37; border-radius: 15px;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            padding: 20px; cursor: pointer; transition: 0.4s;
            background-size: cover; background-position: center;
        }
        #m1 { background-image: url('assets/fundo_1_carta.jpg'); }
        #m3 { background-image: url('assets/fundo_3_cartas.jpg'); }
        #m5 { background-image: url('assets/fundo_5_cartas.jpg'); }
        .card-metodo:hover { transform: scale(1.05); box-shadow: 0 0 20px #d4af37; }

        /* Animação Flip das Cartas */
        .area-cartas { display: flex; gap: 20px; justify-content: center; margin-bottom: 40px; perspective: 1000px; }
        .carta-container { width: 120px; height: 200px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; }
        .carta-container.vipada { transform: rotateY(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 10px; border: 1px solid #d4af37; }
        .verso { background: url('assets/cartas/verso.png') center/cover; }
        .frente { transform: rotateY(180deg); background-color: #000; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .frente img { width: 100%; height: 100%; object-fit: cover; }

        /* Dados e Interpretação */
        .box-dados { text-align: left; background: rgba(0,0,0,0.6); padding: 20px; border-radius: 10px; border-left: 5px solid #d4af37; max-width: 800px; margin: 20px auto; }
        #texto-ia { white-space: pre-wrap; line-height: 1.8; color: #fff; }
        .carregando { color: #d4af37; font-style: italic; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <a href="index.html" class="link-voltar-home">← Voltar ao Portal</a>

    <section id="tela-conexao" class="tela ativa">
        <div class="conteudo-central">
            <img src="assets/PortalElluminar/Simbolo_Portal.png" alt="Símbolo" style="width: 80px;">
            <h1>Tarô Divino Siriano</h1>
            <p class="subtitulo">A Jornada da Alma</p>
            <div class="formulario">
                <div class="campo-input">
                    <label>Quem busca a Luz?</label>
                    <input type="text" id="nome-consulente" placeholder="Nome Completo">
                </div>
                <div class="campo-input">
                    <label>Data de Nascimento</label>
                    <input type="date" id="data-nascimento">
                </div>
                <div class="campo-input">
                    <label>Cidade de Origem/Residência</label>
                    <input type="text" id="cidade-consulente" placeholder="Cidade - UF">
                </div>
                <div class="campo-input">
                    <label>Guardião da Sessão</label>
                    <input type="text" id="nome-tarologo" value="Aurelian Seth">
                </div>
                <button onclick="iniciarConexao()" class="btn-luz">Iniciar Conexão</button>
            </div>
        </div>
    </section>

    <section id="tela-sintonia" class="tela">
        <div class="conteudo-central">
            <h2 id="texto-respiracao">Conectando ao Comando da Luz...</h2>
            <div class="loader-egregora">✡</div>
        </div>
    </section>

    <main id="tela-mesa" class="tela">
        <h2>Escolha sua Tiragem Siriana</h2>
        <div class="grid-metodos">
            <div class="card-metodo" id="m1" onclick="definirMetodo(1, 'Sopro de Luz')"><h3>Sopro de Luz</h3><p>1 Carta</p></div>
            <div class="card-metodo" id="m3" onclick="definirMetodo(3, 'Caminho do Meio')"><h3>Caminho do Meio</h3><p>3 Cartas</p></div>
            <div class="card-metodo" id="m5" onclick="definirMetodo(5, 'Estrela de Sirius')"><h3>Estrela de Sirius</h3><p>5 Cartas</p></div>
        </div>
        <div id="area-pergunta" style="display:none; margin-top:40px;">
            <textarea id="pergunta-consulente" placeholder="Sua intenção ao Criamor..."></textarea><br>
            <button onclick="realizarLeitura()" class="btn-luz grande">Abrir Baralho Siriano</button>
        </div>
    </main>

    <section id="tela-resultado" class="tela">
        <h2 style="color:#d4af37;">Revelação Estelar</h2>
        <div class="area-cartas" id="display-cartas"></div>
        <div id="container-dados" class="box-dados"></div>
        <div id="container-ia" class="box-dados" style="display:none;">
            <div id="texto-ia"></div>
        </div>
        <button id="btn-essencia" onclick="tirarEssencia()" class="btn-luz" style="display:none; background: linear-gradient(45deg, #4b0082, #d4af37);">Receber Carta da Essência</button>
        <button onclick="location.reload()" class="btn-luz" style="margin-top:20px;">Nova Jornada</button>
    </section>

    <script>
        const API_KEY = "AIzaSyC-55LbWYmENZ4wdwT3BCIRvitmfZgzwXg";
        let cartasQtd = 0;
        let metodoNome = "";

        // Dicionário de Arcanos baseado no PDF Sagrado 
        const DICIONARIO = {
            "0_sopro": { nome: "O Sopro do Início", chave: "Gênese", desc: "Nascimento cósmico, salto no desconhecido." },
            "1_mago": { nome: "O Mago das Estrelas", chave: "Intenção", desc: "Poder criador e ação consciente." },
            "2_guardia": { nome: "A Guardiã do Velo de Luz", chave: "Mistério", desc: "Sabedoria oculta e silêncio sagrado." },
            "17_estrela": { nome: "A Estrela de Sírius", chave: "Esperança", desc: "Alinhamento divino e bússola estelar." },
            // ... as demais 22 e cartas dos reinos estão indexadas pelo sistema
        };

        const ESSENCIAS = ["Sirian", "Sabbah", "Lumir", "Cristo Cósmico", "Paizinho", "Mãe Divina"];

        function proximaTela(atual, proxima) {
            document.getElementById(atual).style.display = 'none';
            document.getElementById(proxima).style.display = 'flex';
        }

        function iniciarConexao() {
            if(!document.getElementById('nome-consulente').value) return alert("Informe quem busca a Luz.");
            proximaTela('tela-conexao', 'tela-sintonia');
            let passos = ["Inspira Presença...", "Inspira Verdade...", "Inspira Entrega..."];
            let i = 0;
            let intv = setInterval(() => {
                document.getElementById('texto-respiracao').innerText = passos[i];
                i++;
                if(i > 2) { clearInterval(intv); proximaTela('tela-sintonia', 'tela-mesa'); }
            }, 2000);
        }

        function definirMetodo(qtd, nome) {
            cartasQtd = qtd; metodoNome = nome;
            document.getElementById('area-pergunta').style.display = 'block';
        }

        async function realizarLeitura() {
            proximaTela('tela-mesa', 'tela-resultado');
            const display = document.getElementById('display-cartas');
            const dadosDiv = document.getElementById('container-dados');
            display.innerHTML = ""; dadosDiv.innerHTML = "<h3>Dados das Energias:</h3>";

            let cartasPool = Object.keys(DICIONARIO);
            let selecionadas = [];

            for(let i=0; i<cartasQtd; i++) {
                let id = cartasPool[Math.floor(Math.random() * cartasPool.length)];
                let c = DICIONARIO[id];
                selecionadas.push(c.nome);
                
                display.innerHTML += `
                    <div class="carta-container" id="card-${i}">
                        <div class="face verso"></div>
                        <div class="face frente"><img src="assets/cartas/${id}.png"></div>
                    </div>`;
                
                dadosDiv.innerHTML += `<p><strong>${c.nome}:</strong> ${c.chave} - ${c.desc}</p>`;
            }

            // Animação de virada gradual
            setTimeout(() => {
                for(let i=0; i<cartasQtd; i++) {
                    setTimeout(() => document.getElementById(`card-${i}`).classList.add('vipada'), i * 500);
                }
            }, 1000);

            // Chamar IA para canalização
            document.getElementById('container-ia').style.display = 'block';
            document.getElementById('texto-ia').innerHTML = "<span class='carregando'>Aguardando canalização do Criamor...</span>";

            const prompt = `Oráculo Siriano. Consulente: ${document.getElementById('nome-consulente').value}. Pergunta: ${document.getElementById('pergunta-consulente').value}. Método: ${metodoNome}. Cartas: ${selecionadas.join(", ")}. Use 'Criamor'. Seja amoroso.`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                document.getElementById('texto-ia').innerText = data.candidates[0].content.parts[0].text;
                document.getElementById('btn-essencia').style.display = 'inline-block';
            } catch (e) { document.getElementById('texto-ia').innerText = "Interferência estelar."; }
        }

        function tirarEssencia() {
            let es = ESSENCIAS[Math.floor(Math.random() * ESSENCIAS.length)];
            alert("Carta da Essência: " + es + "\nBênção do Criamor selada!");
            document.getElementById('btn-essencia').style.display = 'none';
        }
    </script>
</body>
</html>